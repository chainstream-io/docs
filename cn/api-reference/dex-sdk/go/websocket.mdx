---
title: 'WebSocket'
description: 'WebSocket 实时数据订阅服务'
---

本文档描述了 ChainStream Go SDK 提供的 WebSocket 订阅方法。每个方法都是对应 WebSocket API 的包装器。有关详细的参数描述和返回值结构，请点击相应的 API 链接。

## K线
- <code>[client.Stream.SubscribeTokenCandles()](/cn/api-reference/endpoint/websocket/api#candles-data)</code>

## 代币
- <code>[client.Stream.SubscribeTokenStats()](/cn/api-reference/endpoint/websocket/api#token-stats)</code>
- <code>[client.Stream.SubscribeTokenHolders()](/cn/api-reference/endpoint/websocket/api#token-holders-statistics)</code>
- <code>[client.Stream.SubscribeNewToken()](/cn/api-reference/endpoint/websocket/api#new-token)</code>
- <code>[client.Stream.SubscribeNewTokensMetadata()](/cn/api-reference/endpoint/websocket/api#new-token-metadata)</code>
- <code>[client.Stream.SubscribeTokenSupply()](/cn/api-reference/endpoint/websocket/api#token-supply)</code>
- <code>[client.Stream.SubscribeTokenLiquidity()](/cn/api-reference/endpoint/websocket/api#token-liquidity)</code>

## 排行榜
- <code>[client.Stream.SubscribeRankingTokensLiquidity()](/cn/api-reference/endpoint/websocket/api#ranking-token-liquidity-data)</code>
- <code>[client.Stream.SubscribeRankingTokensList()](/cn/api-reference/endpoint/websocket/api#ranking-token-list)</code>
- <code>[client.Stream.SubscribeRankingTokensStats()](/cn/api-reference/endpoint/websocket/api#ranking-token-statistics)</code>
- <code>[client.Stream.SubscribeRankingTokensHolders()](/cn/api-reference/endpoint/websocket/api#ranking-token-holders-statistics)</code>
- <code>[client.Stream.SubscribeRankingTokensSupply()](/cn/api-reference/endpoint/websocket/api#ranking-token-supply-data)</code>

## 钱包
- <code>[client.Stream.SubscribeWalletBalance()](/cn/api-reference/endpoint/websocket/api#wallet-balance)</code>
- <code>[client.Stream.SubscribeWalletPnl()](/cn/api-reference/endpoint/websocket/api#wallet-pnl-data-token-level)</code>
- <code>[client.Stream.SubscribeWalletPnlList()](/cn/api-reference/endpoint/websocket/api#wallet-pnl-data-wallet-level)</code>

## 交易
- <code>[client.Stream.SubscribeTokenTrade()](/cn/api-reference/endpoint/websocket/api#token-trade)</code>
- <code>[client.Stream.SubscribeWalletTrade()](/cn/api-reference/endpoint/websocket/api#wallet-trade)</code>

## DexPool
- <code>[client.Stream.SubscribeDexPoolBalance()](/cn/api-reference/endpoint/websocket/api#dex-pool-balance)</code>

## 连接管理

调用 `SubscribeXXX` 方法时，SDK 会自动检测 WebSocket 连接状态，如果未连接会自动建立连接，无需手动调用 `Connect()`。

如果需要提前建立连接（例如减少首次订阅的延迟），可以手动调用：
```go
err := client.Stream.Connect()
if err != nil {
    log.Fatal(err)
}
```

所有订阅方法都返回一个 `Unsubscribe` 函数，可用于取消订阅：

```go
unsubscribe := client.Stream.SubscribeTokenCandles(
    "sol",
    "6p6xgHyF7AeE6TZkSmFsko444wqoP15icUSqi2jfGiPN",
    "1m",
    func(candle api.TokenCandle) {
        log.Printf("新K线: %+v", candle)
    },
    "", // filter（可选）
)

// 取消订阅
unsubscribe()
```

## 批量订阅

批量订阅多个数据流

### 使用示例

```go
unsubscribes, err := client.Stream.BatchSubscribe(func() []func() {
    return []func(){
        func() {
            client.Stream.SubscribeWalletBalance(&api.SubscribeWalletBalanceRequest{
                Chain:         "sol",
                WalletAddress: "钱包地址 1",
                Callback: func(data []*api.WalletBalance) {
                    // todo
                },
            })
        },
        
        func() {
            client.Stream.SubscribeWalletBalance(&api.SubscribeWalletBalanceRequest{
                Chain:         "sol",
                WalletAddress: "钱包地址 2",
                Callback: func(data []*api.WalletBalance) {
                    // todo
                },
            })
        },
    }
})
if err != nil {
    log.Fatal(err)
}

// 取消所有订阅
for _, unsubscribe := range unsubscribes {
    unsubscribe()
}
```

有关详细的参数描述、数据格式和错误处理，请参考 [WebSocket API 文档](/cn/api-reference/endpoint/websocket/api)。
