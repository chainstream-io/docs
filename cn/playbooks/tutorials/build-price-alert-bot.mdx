---
title: "æ„å»ºä»·æ ¼é¢„è­¦æœºå™¨äºº"
description: "ä½¿ç”¨ WebSocket + Telegram æ„å»ºå®æ—¶ä»·æ ¼ç›‘æ§æœºå™¨äºº"
icon: "bell"
---

æœ¬æ•™ç¨‹å°†å¸¦æ‚¨ä»é›¶æ„å»ºä¸€ä¸ªå®æ—¶ä»·æ ¼ç›‘æ§æœºå™¨äººï¼Œå½“ç›®æ ‡ Token ä»·æ ¼å˜åŠ¨è¶…è¿‡è®¾å®šé˜ˆå€¼æ—¶ï¼Œè‡ªåŠ¨å‘é€ Telegram é€šçŸ¥ã€‚

<Info>
**é¢„è®¡æ—¶é—´**ï¼š30 åˆ†é’Ÿ  
**éš¾åº¦ç­‰çº§**ï¼šâ­â­ å…¥é—¨
</Info>

---

## ç›®æ ‡

æ„å»ºä¸€ä¸ªç›‘æ§ä»£å¸ä»·æ ¼å¹¶è‡ªåŠ¨é€šçŸ¥çš„ Botï¼š

```mermaid
flowchart TD
    A[ChainStream WebSocket] --> B[Price Bot]
    B --> C[Telegram é€šçŸ¥]
```

**åŠŸèƒ½æ¸…å•**ï¼š
- âœ… è®¢é˜…å®æ—¶ä»·æ ¼æµ
- âœ… è®¾ç½®ä»·æ ¼å˜åŠ¨è§¦å‘æ¡ä»¶ï¼ˆ> X%ï¼‰
- âœ… å‘é€ Telegram é€šçŸ¥
- âœ… æ”¯æŒå¤šå¸ç§ç›‘æ§

---

## æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯ | ç”¨é€” |
|------|------|------|
| è¯­è¨€ | Node.js 18+ | ä¸»å¼€å‘è¯­è¨€ |
| å®æ—¶æ•°æ® | WebSocket | è®¢é˜…ä»·æ ¼æµ |
| é€šçŸ¥ | Telegram Bot API | å‘é€å‘Šè­¦ |
| é…ç½® | ç¯å¢ƒå˜é‡ | å­˜å‚¨æ•æ„Ÿä¿¡æ¯ |

---

## å‰ç½®æ¡ä»¶

- ChainStream è´¦æˆ·ï¼ˆè·å– Access Tokenï¼‰
- Node.js 18+
- Telegram è´¦å·

---

## Step 1ï¼šè¿æ¥ WebSocket

### 1.1 å®‰è£…ä¾èµ–

```bash
npm install @chainstream-io/sdk node-telegram-bot-api dotenv
```

### 1.2 åˆ›å»ºé¡¹ç›®ç»“æ„

```
price-alert-bot/
â”œâ”€â”€ .env
â”œâ”€â”€ config.js
â”œâ”€â”€ bot.js
â””â”€â”€ index.js
```

### 1.3 é…ç½®æ–‡ä»¶

**.env**ï¼š

```
CHAINSTREAM_ACCESS_TOKEN=your_access_token
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id
```

**config.js**ï¼š

```javascript
import 'dotenv/config';

// ChainStream é…ç½®
export const CHAINSTREAM_ACCESS_TOKEN = process.env.CHAINSTREAM_ACCESS_TOKEN;

// Telegram é…ç½®
export const TELEGRAM_BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN;
export const TELEGRAM_CHAT_ID = process.env.TELEGRAM_CHAT_ID;

// ç›‘æ§é…ç½®
export const WATCH_TOKENS = [
  {
    chain: 'sol',
    address: '6p6xgHyF7AeE6TZkSmFsko444wqoP15icUSqi2jfGiPN',
    symbol: 'EXAMPLE',
    thresholdPercent: 3.0  // 3% å˜åŠ¨è§¦å‘
  },
  {
    chain: 'sol',
    address: 'So11111111111111111111111111111111111111112',
    symbol: 'SOL',
    thresholdPercent: 5.0  // 5% å˜åŠ¨è§¦å‘
  }
];
```

### 1.4 WebSocket è¿æ¥

**index.js**ï¼š

```javascript
import { ChainStreamClient } from '@chainstream-io/sdk';
import { CHAINSTREAM_ACCESS_TOKEN, WATCH_TOKENS } from './config.js';
import { sendAlert } from './bot.js';

class PriceMonitor {
  constructor() {
    this.client = new ChainStreamClient(CHAINSTREAM_ACCESS_TOKEN);
    this.lastPrices = new Map(); // è®°å½•ä¸Šæ¬¡ä»·æ ¼
  }

  async start() {
    console.log('âœ… å¼€å§‹ç›‘æ§ä»·æ ¼...');

    // è®¢é˜…æ¯ä¸ª Token çš„ç»Ÿè®¡æ•°æ®
    for (const token of WATCH_TOKENS) {
      this.subscribeToken(token);
    }
  }

  subscribeToken(token) {
    this.client.stream.subscribeTokenStats({
      chain: token.chain,
      tokenAddress: token.address,
      callback: (data) => this.handlePriceUpdate(token, data)
    });

    console.log(`ğŸ“¡ å·²è®¢é˜… ${token.symbol} ä»·æ ¼æµ`);
  }

  handlePriceUpdate(token, data) {
    const currentPrice = data.price || data.p;
    if (!currentPrice) return;

    const lastPrice = this.lastPrices.get(token.address);

    if (lastPrice) {
      // è®¡ç®—å˜åŠ¨ç™¾åˆ†æ¯”
      const changePercent = ((currentPrice - lastPrice) / lastPrice) * 100;

      // æ£€æŸ¥æ˜¯å¦è§¦å‘å‘Šè­¦
      if (Math.abs(changePercent) >= token.thresholdPercent) {
        this.triggerAlert(token, currentPrice, changePercent);
      }
    }

    // æ›´æ–°ä»·æ ¼è®°å½•
    this.lastPrices.set(token.address, currentPrice);
  }

  async triggerAlert(token, price, change) {
    const direction = change > 0 ? 'ğŸ“ˆ ä¸Šæ¶¨' : 'ğŸ“‰ ä¸‹è·Œ';

    const message = `
${direction} ä»·æ ¼å‘Šè­¦ï¼

ğŸª™ Token: ${token.symbol}
ğŸ’° å½“å‰ä»·æ ¼: $${price.toFixed(6)}
ğŸ“Š å˜åŠ¨å¹…åº¦: ${change >= 0 ? '+' : ''}${change.toFixed(2)}%
âš¡ è§¦å‘é˜ˆå€¼: ${token.thresholdPercent}%
    `.trim();

    await sendAlert(message);
    console.log(`ğŸš¨ å·²å‘é€å‘Šè­¦: ${token.symbol} ${change >= 0 ? '+' : ''}${change.toFixed(2)}%`);
  }
}

// å¯åŠ¨ç›‘æ§
const monitor = new PriceMonitor();
monitor.start();
```

---

## Step 2ï¼šè®¾ç½®è§¦å‘æ¡ä»¶

è§¦å‘æ¡ä»¶å·²åœ¨ `config.js` ä¸­é…ç½®ï¼š

```javascript
export const WATCH_TOKENS = [
  {
    symbol: 'EXAMPLE',
    thresholdPercent: 3.0  // ä»·æ ¼å˜åŠ¨ > 3% æ—¶è§¦å‘
  },
  // ...
];
```

### é«˜çº§è§¦å‘æ¡ä»¶

å¯ä»¥æ‰©å±•ä¸ºæ›´å¤æ‚çš„æ¡ä»¶ï¼š

```javascript
// å¤šæ¡ä»¶è§¦å‘
const ALERT_CONDITIONS = {
  priceChange: {
    enabled: true,
    thresholdPercent: 5.0
  },
  priceAbove: {
    enabled: true,
    value: 100  // ä»·æ ¼è¶…è¿‡ $100 æ—¶è§¦å‘
  },
  priceBelow: {
    enabled: true,
    value: 50   // ä»·æ ¼ä½äº $50 æ—¶è§¦å‘
  }
};
```

---

## Step 3ï¼šå‘é€é€šçŸ¥

### 3.1 åˆ›å»º Telegram Bot

<Steps>
  <Step title="åˆ›å»º Bot">
    åœ¨ Telegram ä¸­æœç´¢ `@BotFather`ï¼Œå‘é€ `/newbot`
  </Step>
  <Step title="è·å– Token">
    æŒ‰æç¤ºåˆ›å»º Botï¼Œè·å– Bot Token
  </Step>
  <Step title="è·å– Chat ID">
    - ç»™ Bot å‘é€ä¸€æ¡æ¶ˆæ¯
    - è®¿é—® `https://api.telegram.org/bot<TOKEN>/getUpdates`
    - æ‰¾åˆ° `chat.id`
  </Step>
</Steps>

### 3.2 Telegram é€šçŸ¥æ¨¡å—

**bot.js**ï¼š

```javascript
import TelegramBot from 'node-telegram-bot-api';
import { TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID } from './config.js';

const bot = new TelegramBot(TELEGRAM_BOT_TOKEN);

export async function sendAlert(message) {
  try {
    await bot.sendMessage(TELEGRAM_CHAT_ID, message, {
      parse_mode: 'HTML'
    });
  } catch (error) {
    console.error(`âŒ Telegram å‘é€å¤±è´¥: ${error.message}`);
  }
}

export async function sendAlertWithRetry(message, maxRetries = 3) {
  for (let attempt = 0; attempt < maxRetries; attempt++) {
    try {
      await sendAlert(message);
      return true;
    } catch (error) {
      if (attempt < maxRetries - 1) {
        // æŒ‡æ•°é€€é¿
        await new Promise(resolve => setTimeout(resolve, 2 ** attempt * 1000));
      } else {
        console.error(`âŒ é€šçŸ¥å‘é€å¤±è´¥ï¼Œå·²é‡è¯• ${maxRetries} æ¬¡`);
        return false;
      }
    }
  }
}
```

---

## éªŒè¯å®‰è£…

### è¿è¡Œ Bot

```bash
node index.js
```

### é¢„æœŸè¾“å‡º

```
âœ… å¼€å§‹ç›‘æ§ä»·æ ¼...
ğŸ“¡ å·²è®¢é˜… EXAMPLE ä»·æ ¼æµ
ğŸ“¡ å·²è®¢é˜… SOL ä»·æ ¼æµ
```

### è§¦å‘æµ‹è¯•

å¯ä»¥ä¸´æ—¶å°†é˜ˆå€¼è®¾ä¸º 0.01% æ¥å¿«é€Ÿæµ‹è¯•ï¼š

```javascript
thresholdPercent: 0.01  // æµ‹è¯•ç”¨
```

---

## æ‰©å±•å»ºè®®

<Tabs>
  <Tab title="å¤šå¸ç§ç›‘æ§">
```javascript
// ä» API åŠ¨æ€è·å–ç›‘æ§åˆ—è¡¨
async function fetchWatchlist() {
  const response = await fetch('https://api.chainstream.io/v1/watchlist');
  return response.json();
}
```
  </Tab>
  <Tab title="æŒä¹…åŒ–å­˜å‚¨">
```javascript
import Database from 'better-sqlite3';

const db = new Database('alerts.db');

// åˆ›å»ºè¡¨
db.exec(`
  CREATE TABLE IF NOT EXISTS alerts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    symbol TEXT,
    price REAL,
    change REAL,
    timestamp INTEGER
  )
`);

function saveAlert(alertData) {
  const stmt = db.prepare(`
    INSERT INTO alerts (symbol, price, change, timestamp)
    VALUES (?, ?, ?, ?)
  `);
  stmt.run(
    alertData.symbol,
    alertData.price,
    alertData.change,
    Date.now()
  );
}
```
  </Tab>
  <Tab title="Web ä»ªè¡¨ç›˜">
```javascript
import express from 'express';

const app = express();

app.get('/alerts', (req, res) => {
  const alerts = getRecentAlerts();
  res.json({ alerts });
});

app.post('/config', (req, res) => {
  // æ›´æ–°ç›‘æ§é…ç½®
  updateConfig(req.body);
  res.json({ success: true });
});

app.listen(3000);
```
  </Tab>
  <Tab title="å¤šé€šçŸ¥æ¸ é“">
```javascript
async function sendNotification(message, channels) {
  const tasks = [];
  
  if (channels.includes('telegram')) {
    tasks.push(sendTelegram(message));
  }
  if (channels.includes('discord')) {
    tasks.push(sendDiscord(message));
  }
  if (channels.includes('email')) {
    tasks.push(sendEmail(message));
  }
  
  await Promise.all(tasks);
}
```
  </Tab>
</Tabs>

---

## å¸¸è§é—®é¢˜

<AccordionGroup>
  <Accordion title="WebSocket è¿æ¥å¤±è´¥ï¼Ÿ" icon="plug">
    1. æ£€æŸ¥ Access Token æ˜¯å¦æ­£ç¡®
    2. ç¡®è®¤ç½‘ç»œå¯è®¿é—® ChainStream
    3. æŸ¥çœ‹æ˜¯å¦æœ‰é˜²ç«å¢™é™åˆ¶ WebSocket
  </Accordion>
  
  <Accordion title="Telegram é€šçŸ¥æ”¶ä¸åˆ°ï¼Ÿ" icon="telegram">
    1. ç¡®è®¤ Bot Token æ­£ç¡®
    2. ç¡®è®¤ Chat ID æ­£ç¡®
    3. ç¡®ä¿å·²ç»™ Bot å‘é€è¿‡æ¶ˆæ¯ï¼ˆæ¿€æ´»å¯¹è¯ï¼‰
  </Accordion>
  
  <Accordion title="å¦‚ä½•ç›‘æ§æ›´å¤š Tokenï¼Ÿ" icon="coins">
    åœ¨ `config.js` çš„ `WATCH_TOKENS` æ•°ç»„ä¸­æ·»åŠ æ›´å¤šé…ç½®å³å¯ã€‚
  </Accordion>
</AccordionGroup>

---

## ç›¸å…³æ–‡æ¡£

<CardGroup cols={2}>
  <Card title="WebSocket API" icon="plug" href="/cn/api-reference/endpoint/websocket/api">
    WebSocket è®¢é˜…è¯¦æƒ…
  </Card>
  <Card title="Webhook åŸºç¡€" icon="webhook" href="/cn/playbooks/frameworks/webhook-fundamentals">
    ä½¿ç”¨ Webhook æ›¿ä»£ WebSocket
  </Card>
</CardGroup>
